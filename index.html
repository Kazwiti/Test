<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Truth or Dare - Extremely Naughty Edition</title>
<style>
  body { font-family: Arial, sans-serif; background: #111; color: #eee; text-align: center; padding: 20px; }
  input, select, button { padding: 10px 15px; margin: 5px; font-size: 1rem; border-radius: 8px; border: none; }
  button { cursor: pointer; }
  button:disabled { opacity: 0.5; cursor: default; }
  #player-list { margin: 10px 0; font-weight: bold; }
  #challenge { margin-top: 30px; padding: 20px; background: #222; border-radius: 12px; min-height: 100px; max-width: 400px; margin-left:auto; margin-right:auto; }
  #challenge p { font-size: 1.2rem; user-select: text; }
  label { font-weight: bold; }
</style>
</head>
<body>
<h1>Truth or Dare - Extremely Naughty Edition</h1>

<!-- Login -->
<div id="loginSection">
  <input type="text" id="usernameInput" placeholder="Enter username" />
  <select id="genderSelect">
    <option value="">Select Gender</option>
    <option value="male">Male</option>
    <option value="female">Female</option>
  </select>
  <button id="loginBtn">Login</button>
</div>

<!-- Game -->
<div id="gameSection" style="display:none;">
  <div id="player-list">Players: None</div>
  <div>
    <label for="mode">Choose game mode:</label>
    <select id="mode">
      <option value="spicy" selected>Extremely Naughty</option>
      <option value="fun">Fun</option>
    </select>
  </div>
  <div>
    <button id="truthBtn" disabled>Truth</button>
    <button id="dareBtn" disabled>Dare</button>
  </div>
  <div id="challenge"><p>Add players to start the game!</p></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDNSy0zdokELU4CxSoy7zJXHAuBPQqLaO0",
  authDomain: "truthor-dare-multiplayer.firebaseapp.com",
  databaseURL: "https://truthor-dare-multiplayer-default-rtdb.firebaseio.com",
  projectId: "truthor-dare-multiplayer",
  storageBucket: "truthor-dare-multiplayer.firebasestorage.app",
  messagingSenderId: "51895740835",
  appId: "1:51895740835:web:783c3755a60ca0ad831216",
  measurementId: "G-V857KJ9N6L"
};
firebase.initializeApp(firebaseConfig);
const rdb = firebase.database();

let username = "";
let gender = "";
let players = [];
let mode = "spicy";
const gameId = "main-room";

const loginBtn = document.getElementById("loginBtn");
const usernameInput = document.getElementById("usernameInput");
const genderSelect = document.getElementById("genderSelect");
const loginSection = document.getElementById("loginSection");
const gameSection = document.getElementById("gameSection");
const playerListDiv = document.getElementById("player-list");
const modeSelect = document.getElementById("mode");
const truthBtn = document.getElementById("truthBtn");
const dareBtn = document.getElementById("dareBtn");
const challengeDiv = document.getElementById("challenge");

loginBtn.addEventListener("click", () => {
  username = usernameInput.value.trim();
  gender = genderSelect.value;
  if (!username || !gender) { alert("Enter username & gender"); return; }

  const playerRef = rdb.ref(`games/${gameId}/players/${username}`);
  playerRef.set({ name: username, gender: gender });
  playerRef.onDisconnect().remove(); // auto remove on close

  loginSection.style.display = "none";
  gameSection.style.display = "block";

  listenForPlayers();
  listenForChallenges();
  listenForMode();
});

function listenForPlayers() {
  rdb.ref(`games/${gameId}/players`).on("value", snap => {
    players = Object.values(snap.val() || {});
    playerListDiv.textContent = players.length
      ? "Players: " + players.map(p => p.name).join(", ")
      : "Players: None";
    truthBtn.disabled = dareBtn.disabled = (players.length !== 2);
  });
}

function listenForChallenges() {
  rdb.ref(`games/${gameId}/currentChallenge`).on("value", snap => {
    const c = snap.val();
    if (c) challengeDiv.innerHTML = `<p><strong>${c.player}</strong> chose <em>${c.type}</em>: ${c.text}</p>`;
  });
}
function listenForMode() {
  rdb.ref(`games/${gameId}/mode`).on("value", snap => {
    const m = snap.val();
    if (m) { mode = m; modeSelect.value = m; }
  });
}

modeSelect.addEventListener("change", () => {
  mode = modeSelect.value;
  rdb.ref(`games/${gameId}/mode`).set(mode);
});

truthBtn.addEventListener("click", () => pickChallenge("truth"));
dareBtn.addEventListener("click", () => pickChallenge("dare"));

function pickChallenge(type) {
  const activePlayer = players[Math.floor(Math.random() * players.length)];
  let challengeText = "";
  if (mode === "spicy") {
    challengeText = type === "truth"
      ? questionSets.spicy[activePlayer.gender].truths[Math.floor(Math.random()*questionSets.spicy[activePlayer.gender].truths.length)]
      : questionSets.spicy[activePlayer.gender].dares[Math.floor(Math.random()*questionSets.spicy[activePlayer.gender].dares.length)];
  } else {
    challengeText = type === "truth"
      ? questionSets.fun[activePlayer.gender].truths[Math.floor(Math.random()*questionSets.fun[activePlayer.gender].truths.length)]
      : questionSets.fun[activePlayer.gender].dares[Math.floor(Math.random()*questionSets.fun[activePlayer.gender].dares.length)];
  }
  rdb.ref(`games/${gameId}/currentChallenge`).set({ player: activePlayer.name, type, text: challengeText });
}

// ================= TRUTH & DARES =================
const maleTruths = ["What's your wildest fantasy?"];
const femaleTruths = ["Who would you kiss in this room?"];
const maleDares = ["Male Dare Example"];
const femaleDares = ["Female Dare Example"];
maleDares.push("Both Dare Example");
femaleDares.push("Both Dare Example");
maleTruths.push("Both Truth Example");
femaleTruths.push("Both Truth Example");

const funMaleTruths = ["Fun male truth 1"];
const funFemaleTruths = ["Fun female truth 1"];
const funMaleDares = ["Fun male dare 1"];
const funFemaleDares = ["Fun female dare 1"];

const questionSets = {
  spicy: { male: { truths: maleTruths, dares: maleDares }, female: { truths: femaleTruths, dares: femaleDares }},
  fun: { male: { truths: funMaleTruths, dares: funMaleDares }, female: { truths: funFemaleTruths, dares: funFemaleDares }}
};
</script>
</body>
</html>