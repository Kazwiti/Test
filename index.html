<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Truth or Dare - Extremely Naughty Edition</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #eee;
    text-align: center;
    padding: 20px;
  }
  input, select, button {
    padding: 10px 15px;
    margin: 5px;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
  }
  button {
    cursor: pointer;
  }
  button:disabled {
    opacity: 0.5;
    cursor: default;
  }
  #player-list {
    margin: 10px 0;
    font-weight: bold;
  }
  #challenge {
    margin-top: 30px;
    padding: 20px;
    background: #222;
    border-radius: 12px;
    min-height: 100px;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }
  #challenge p {
    font-size: 1.2rem;
    user-select: text;
  }
  label {
    font-weight: bold;
  }
  #mode-select {
    margin-top: 15px;
  }

  /* small lobby area styling */
  #lobby {
    margin-bottom: 12px;
  }
  #roomInfo {
    margin-top: 8px;
    font-size: 0.95rem;
    color: #ddd;
  }
</style>
</head>
<body>

<h1>Truth or Dare - Extremely Naughty Edition</h1>

<!-- Multiplayer lobby controls (non-intrusive) -->
<div id="lobby">
  <input type="text" id="roomInput" placeholder="Enter or create room code" aria-label="Room code" />
  <button id="createRoomBtn">Create Room</button>
  <button id="joinRoomBtn">Join Room</button>
  <div id="roomInfo" aria-live="polite"></div>
</div>

<!-- Existing player input area -->
<div>
  <input type="text" id="player-name" placeholder="Enter player name" aria-label="Player name" />
  <label for="player-gender">Gender:</label>
  <select id="player-gender" aria-label="Player gender">
    <option value="male" selected>Male</option>
    <option value="female">Female</option>
  </select>
  <button id="addPlayerBtn">Add Player</button>
</div>

<div id="player-list" aria-live="polite" aria-atomic="true">Players: None</div>

<div id="mode-select">
  <label for="mode">Choose game mode:</label>
  <select id="mode" aria-label="Game mode">
    <option value="spicy" selected>Extremely Naughty</option>
    <option value="fun">Fun</option>
  </select>
</div>

<div>
  <button id="truthBtn" disabled>Truth</button>
  <button id="dareBtn" disabled>Dare</button>
</div>

<div id="challenge" role="region" aria-live="polite" aria-atomic="true">
  <p>Add players to start the game!</p>
</div>

<!-- Firebase Realtime Database (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // --- Firebase config with your actual project values ---
  const firebaseConfig = {
    apiKey: "AIzaSyDNSy0zdokELU4CxSoy7zJXHAuBPQqLaO0",
    authDomain: "truthor-dare-multiplayer.firebaseapp.com",
    databaseURL: "https://truthor-dare-multiplayer-default-rtdb.firebaseio.com",
    projectId: "truthor-dare-multiplayer",
    storageBucket: "truthor-dare-multiplayer.appspot.com",
    messagingSenderId: "51895740835",
    appId: "1:51895740835:web:783c3755a60ca0ad831216"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const rdb = firebase.database();

  // Multiplayer session variables
  let gameId = null; // the room code / session id
  let isSyncing = false; // true when connected to a game
  const localClientId = Math.random().toString(36).slice(2,10); // small id for this browser instance

  const roomInput = document.getElementById('roomInput');
  const createRoomBtn = document.getElementById('createRoomBtn');
  const joinRoomBtn = document.getElementById('joinRoomBtn');
  const roomInfo = document.getElementById('roomInfo');

  createRoomBtn.addEventListener('click', () => {
    // generate a simple 6-char room code
    const code = Math.random().toString(36).slice(2,8).toUpperCase();
    // set URL param and start session
    const newUrl = new URL(window.location.href);
    newUrl.searchParams.set('game', code);
    window.history.replaceState({}, '', newUrl);
    roomInput.value = code;
    startSession(code);
  });

  joinRoomBtn.addEventListener('click', () => {
    const code = roomInput.value.trim().toUpperCase();
    if (!code) {
      alert('Enter a room code to join or create one.');
      return;
    }
    // set URL param and start session
    const newUrl = new URL(window.location.href);
    newUrl.searchParams.set('game', code);
    window.history.replaceState({}, '', newUrl);
    startSession(code);
  });

  // Auto-join if ?game=CODE present
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.has('game')) {
    const code = urlParams.get('game').toUpperCase();
    roomInput.value = code;
    startSession(code);
  }

  // helper to set room info text
  function setRoomInfo(text) {
    roomInfo.textContent = text;
  }
</script>

<script>
  // Local players array
  const players = [];

  // UI Elements
  const playerNameInput = document.getElementById('player-name');
  const playerGenderSelect = document.getElementById('player-gender');
  const addPlayerBtn = document.getElementById('addPlayerBtn');
  const playerListDiv = document.getElementById('player-list');
  const modeSelect = document.getElementById('mode');
  const truthBtn = document.getElementById('truthBtn');
  const dareBtn = document.getElementById('dareBtn');
  const challengeDiv = document.getElementById('challenge');

  // Current mode
  let mode = modeSelect.value;

  // Update buttons state based on players count
  function updateButtonsState() {
    const hasPlayers = players.length > 0;
    truthBtn.disabled = !hasPlayers;
    dareBtn.disabled = !hasPlayers;
  }

  // Update the player list UI
  function updatePlayerList() {
    if (players.length === 0) {
      playerListDiv.textContent = 'Players: None';
      return;
    }
    const names = players.map(p => `${p.name} (${p.gender})`);
    playerListDiv.textContent = 'Players: ' + names.join(', ');
  }

  // Add player locally and sync to Firebase if connected
  function addPlayer(name, gender) {
    name = name.trim();
    if (!name) {
      alert('Please enter a player name.');
      return;
    }
    // Prevent duplicates (case insensitive)
    if (players.some(p => p.name.toLowerCase() === name.toLowerCase())) {
      alert('Player name already added.');
      return;
    }
    const newPlayer = { name, gender };
    players.push(newPlayer);
    updatePlayerList();
    updateButtonsState();

    // Sync to Firebase if connected
    if (isSyncing && gameId) {
      const key = name.toLowerCase();
      rdb.ref(`games/${gameId}/players/${key}`).set(newPlayer).catch(err => console.error(err));
    }
  }

  // Remove player locally and from Firebase if connected
  function removePlayer(name) {
    const idx = players.findIndex(p => p.name.toLowerCase() === name.toLowerCase());
    if (idx === -1) return;
    players.splice(idx, 1);
    updatePlayerList();
    updateButtonsState();

    if (isSyncing && gameId) {
      const key = name.toLowerCase();
      rdb.ref(`games/${gameId}/players/${key}`).remove().catch(err => console.error(err));
    }
  }

  // Add Player button event
  addPlayerBtn.addEventListener('click', () => {
    addPlayer(playerNameInput.value, playerGenderSelect.value);
    playerNameInput.value = '';
    playerNameInput.focus();
  });

  // Mode change sync locally and to Firebase
  modeSelect.addEventListener('change', () => {
    mode = modeSelect.value;
    if (isSyncing && gameId) {
      rdb.ref(`games/${gameId}/mode`).set(mode).catch(err => console.error(err));
    }
  });

  // Start or join a game session (room) and sync game state via Realtime Database
  function startSession(code) {
    if (isSyncing) {
      // If already syncing with another session, detach previous listeners
      rdb.ref(`games/${gameId}/players`).off();
      rdb.ref(`games/${gameId}/currentChallenge`).off();
      rdb.ref(`games/${gameId}/mode`).off();
      rdb.ref(`games/${gameId}/scoreboard`).off();
    }

    gameId = code;
    isSyncing = true;
    setRoomInfo(`Joined room: ${gameId}`);

    const gameRef = rdb.ref(`games/${gameId}`);

    // Initialize game if not exists
    gameRef.once('value').then(snap => {
      if (!snap.exists()) {
        gameRef.set({
          createdAt: Date.now(),
          mode: mode,
          currentChallenge: null,
          scoreboard: {},
          players: {}
        }).catch(err => console.error(err));
      }
    }).catch(err => console.error(err));

    // Listen for player list changes
    rdb.ref(`games/${gameId}/players`).on('value', snapshot => {
      const playersData = snapshot.val() || {};
      players.length = 0; // clear local array
      for (const key in playersData) {
        if (Object.hasOwn(playersData, key)) {
          players.push(playersData[key]);
        }
      }
      updatePlayerList();
      updateButtonsState();
      renderScoreboard();
    });

    // Listen for current challenge changes
    rdb.ref(`games/${gameId}/currentChallenge`).on('value', snapshot => {
      const challenge = snapshot.val();
      if (challenge) {
        showChallengeForClient(challenge);
      } else {
        resetChallenge();
      }
    });

    // Listen for game mode changes
    rdb.ref(`games/${gameId}/mode`).on('value', snapshot => {
      const newMode = snapshot.val();
      if (newMode) {
        mode = newMode;
        modeSelect.value = mode;
      }
    });

    // Listen scoreboard changes
    rdb.ref(`games/${gameId}/scoreboard`).on('value', snapshot => {
      const sb = snapshot.val() || {};
      Object.keys(sb).forEach(k => scoreboard[k] = sb[k]);
      renderScoreboard();
    });
  }

  // Reset challenge UI when no active challenge
  function resetChallenge() {
    challengeDiv.innerHTML = `<p>Choose Truth or Dare and have fun!</p>`;
  }
</script>

<script>
  // Utility to pick a random element from an array
  function pickRandom(array) {
    return array[Math.floor(Math.random() * array.length)];
  }

  // Build a challenge object to push to Firebase
  function buildChallengeObj(player, type, text) {
    return { player, type, text, byClient: localClientId, timestamp: Date.now() };
  }

  // Push current challenge to Firebase DB for syncing
  function pushChallengeToDB(challengeObj) {
    if (!isSyncing || !gameId) return;
    rdb.ref(`games/${gameId}/currentChallenge`).set(challengeObj).catch(err => console.error(err));
  }

  // Push updated scoreboard to Firebase DB
  function pushScoresToDB(scoreboard) {
    if (!isSyncing || !gameId) return;
    rdb.ref(`games/${gameId}/scoreboard`).set(scoreboard).catch(err => console.error(err));
  }

  // Generate a challenge of specified type ("truth" or "dare")
  function getChallenge(type) {
    if (players.length === 0) {
      return { player: null, text: "Add players first!" };
    }
    const player = pickRandom(players);
    if (mode === "spicy") {
      if (type === "truth") {
        const text = pickRandom(spicyTruths);
        const obj = buildChallengeObj(player, "truth", text);
        pushChallengeToDB(obj);
        return { player, text };
      } else {
        // Filter dares by gender (or both)
        const filteredDares = spicyDares.filter(
          (d) => d.gender === "both" || d.gender === player.gender
        );
        if (filteredDares.length === 0) {
          return { player, text: "No dares available for this gender." };
        }
        const text = pickRandom(filteredDares).text;
        const obj = buildChallengeObj(player, "dare", text);
        pushChallengeToDB(obj);
        return { player, text };
      }
    } else { // fun mode
      if (type === "truth") {
        const text = pickRandom(funTruths);
        const obj = buildChallengeObj(player, "truth", text);
        pushChallengeToDB(obj);
        return { player, text };
      } else {
        const text = pickRandom(funDares);
        const obj = buildChallengeObj(player, "dare", text);
        pushChallengeToDB(obj);
        return { player, text };
      }
    }
  }

  // Display challenge in UI for client (called on DB update)
  function showChallengeForClient(challengeObj) {
    if (!challengeObj || !challengeObj.player) {
      challengeDiv.innerHTML = `<p>${challengeObj && challengeObj.text ? challengeObj.text : "Add players first!"}</p>`;
      return;
    }
    const name = challengeObj.player.name || challengeObj.player;
    const capType = challengeObj.type ? challengeObj.type.charAt(0).toUpperCase() + challengeObj.type.slice(1) : "Challenge";
    challengeDiv.innerHTML = `<p><strong>${name}'s ${capType}:</strong> ${challengeObj.text}</p>`;
  }

  // Event listeners for Truth and Dare buttons
  truthBtn.addEventListener("click", () => {
    const result = getChallenge("truth");
    if (!result.player) {
      challengeDiv.innerHTML = `<p>${result.text}</p>`;
    } else {
      challengeDiv.innerHTML = `<p><strong>${result.player.name}'s Truth:</strong> ${result.text}</p>`;
    }
  });

  dareBtn.addEventListener("click", () => {
    const result = getChallenge("dare");
    if (!result.player) {
      challengeDiv.innerHTML = `<p>${result.text}</p>`;
    } else {
      challengeDiv.innerHTML = `<p><strong>${result.player.name}'s Dare:</strong> ${result.text}</p>`;
    }
  });

  // Local scoreboard object to track points by player
  const scoreboard = {};

  // Render scoreboard UI below challenge
  function renderScoreboard() {
    let sb = document.getElementById('scoreboard');
    if (!sb) {
      sb = document.createElement('div');
      sb.id = 'scoreboard';
      sb.style.maxWidth = '400px';
      sb.style.margin = '14px auto';
      sb.style.background = '#222';
      sb.style.borderRadius = '8px';
      sb.style.padding = '10px';
      sb.style.textAlign = 'left';
      challengeDiv.parentNode.insertBefore(sb, challengeDiv.nextSibling);
    }
    let html = '<strong>Scoreboard</strong><ul style="list-style:none;padding:6px 0;margin:0;">';
    if (players.length === 0) html += '<li>No players yet.</li>';
    players.forEach(p => {
      const pts = scoreboard[p.name] || 0;
      html += `<li>${p.name}: ${pts} point${pts === 1 ? '' : 's'}</li>`;
    });
    html += '</ul>';
    sb.innerHTML = html;
  }

  // Award a point to a player and sync scoreboard
  function awardPoint(playerName) {
    scoreboard[playerName] = (scoreboard[playerName] || 0) + 1;
    renderScoreboard();
    pushScoresToDB(scoreboard);
  }

  // Fail challenge (no points awarded)
  function failChallenge() {
    // Can extend to log fails if needed
  }
</script>


<script>
  // --- Firebase config with your actual project values ---
  const firebaseConfig = {
    apiKey: "AIzaSyDNSy0zdokELU4CxSoy7zJXHAuBPQqLaO0",
    authDomain: "truthor-dare-multiplayer.firebaseapp.com",
    databaseURL: "https://truthor-dare-multiplayer-default-rtdb.firebaseio.com",
    projectId: "truthor-dare-multiplayer",
    storageBucket: "truthor-dare-multiplayer.appspot.com",
    messagingSenderId: "51895740835",
    appId: "1:51895740835:web:783c3755a60ca0ad831216"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const rdb = firebase.database();

  // Multiplayer session variables
  let gameId = null;
  let isSyncing = false;
  const localClientId = Math.random().toString(36).slice(2,10);

  const roomInput = document.getElementById('roomInput');
  const createRoomBtn = document.getElementById('createRoomBtn');
  const joinRoomBtn = document.getElementById('joinRoomBtn');
  const roomInfo = document.getElementById('roomInfo');

  createRoomBtn.addEventListener('click', () => {
    const code = Math.random().toString(36).slice(2,8).toUpperCase();
    const newUrl = new URL(window.location.href);
    newUrl.searchParams.set('game', code);
    window.history.replaceState({}, '', newUrl);
    roomInput.value = code;
    startSession(code);
  });

  joinRoomBtn.addEventListener('click', () => {
    const code = roomInput.value.trim().toUpperCase();
    if (!code) {
      alert('Enter a room code to join or create one.');
      return;
    }
    const newUrl = new URL(window.location.href);
    newUrl.searchParams.set('game', code);
    window.history.replaceState({}, '', newUrl);
    startSession(code);
  });

  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.has('game')) {
    const code = urlParams.get('game').toUpperCase();
    roomInput.value = code;
    startSession(code);
  }

  function setRoomInfo(text) {
    roomInfo.textContent = text;
  }
</script>

<script>
  // Player and UI setup
  const players = [];

  const playerNameInput = document.getElementById('player-name');
  const playerGenderSelect = document.getElementById('player-gender');
  const addPlayerBtn = document.getElementById('addPlayerBtn');
  const playerListDiv = document.getElementById('player-list');
  const modeSelect = document.getElementById('mode');
  const truthBtn = document.getElementById('truthBtn');
  const dareBtn = document.getElementById('dareBtn');
  const challengeDiv = document.getElementById('challenge');

  let mode = modeSelect.value;

  function updateButtonsState() {
    const hasPlayers = players.length > 0;
    truthBtn.disabled = !hasPlayers;
    dareBtn.disabled = !hasPlayers;
  }

  function updatePlayerList() {
    if (players.length === 0) {
      playerListDiv.textContent = 'Players: None';
      return;
    }
    const names = players.map(p => `${p.name} (${p.gender})`);
    playerListDiv.textContent = 'Players: ' + names.join(', ');
  }

  function addPlayer(name, gender) {
    name = name.trim();
    if (!name) {
      alert('Please enter a player name.');
      return;
    }
    if (players.some(p => p.name.toLowerCase() === name.toLowerCase())) {
      alert('Player name already added.');
      return;
    }
    const newPlayer = { name, gender };
    players.push(newPlayer);
    updatePlayerList();
    updateButtonsState();

    if (isSyncing && gameId) {
      const key = name.toLowerCase();
      rdb.ref(`games/${gameId}/players/${key}`).set(newPlayer).catch(err => console.error(err));
    }
  }

  function removePlayer(name) {
    const idx = players.findIndex(p => p.name.toLowerCase() === name.toLowerCase());
    if (idx === -1) return;
    players.splice(idx, 1);
    updatePlayerList();
    updateButtonsState();

    if (isSyncing && gameId) {
      const key = name.toLowerCase();
      rdb.ref(`games/${gameId}/players/${key}`).remove().catch(err => console.error(err));
    }
  }

  addPlayerBtn.addEventListener('click', () => {
    addPlayer(playerNameInput.value, playerGenderSelect.value);
    playerNameInput.value = '';
    playerNameInput.focus();
  });

  modeSelect.addEventListener('change', () => {
    mode = modeSelect.value;
    if (isSyncing && gameId) {
      rdb.ref(`games/${gameId}/mode`).set(mode).catch(err => console.error(err));
    }
  });

  function startSession(code) {
    if (isSyncing) {
      rdb.ref(`games/${gameId}/players`).off();
      rdb.ref(`games/${gameId}/currentChallenge`).off();
      rdb.ref(`games/${gameId}/mode`).off();
      rdb.ref(`games/${gameId}/scoreboard`).off();
    }

    gameId = code;
    isSyncing = true;
    setRoomInfo(`Joined room: ${gameId}`);

    const gameRef = rdb.ref(`games/${gameId}`);

    gameRef.once('value').then(snap => {
      if (!snap.exists()) {
        gameRef.set({
          createdAt: Date.now(),
          mode: mode,
          currentChallenge: null,
          scoreboard: {},
          players: {}
        }).catch(err => console.error(err));
      }
    }).catch(err => console.error(err));

    rdb.ref(`games/${gameId}/players`).on('value', snapshot => {
      const playersData = snapshot.val() || {};
      players.length = 0;
      for (const key in playersData) {
        if (Object.hasOwn(playersData, key)) {
          players.push(playersData[key]);
        }
      }
      updatePlayerList();
      updateButtonsState();
      renderScoreboard();
    });

    rdb.ref(`games/${gameId}/currentChallenge`).on('value', snapshot => {
      const challenge = snapshot.val();
      if (challenge) {
        showChallengeForClient(challenge);
      } else {
        resetChallenge();
      }
    });

    rdb.ref(`games/${gameId}/mode`).on('value', snapshot => {
      const newMode = snapshot.val();
      if (newMode) {
        mode = newMode;
        modeSelect.value = mode;
      }
    });

    rdb.ref(`games/${gameId}/scoreboard`).on('value', snapshot => {
      const sb = snapshot.val() || {};
      Object.keys(sb).forEach(k => scoreboard[k] = sb[k]);
      renderScoreboard();
    });
  }

  function resetChallenge() {
    challengeDiv.innerHTML = `<p>Choose Truth or Dare and have fun!</p>`;
  }
</script>

<script>
  // Challenge lists

  // 40 Spicy Dares
  const spicyDares = [
    { gender: "both", text: "Send me a teasing photo — just enough to make me want more." },
    { gender: "both", text: "Whisper your dirtiest fantasy about me into the mic for 15 seconds." },
    { gender: "both", text: "Act out the first time we had sex." },
    { gender: "female", text: "Moan softly into the mic like you’re thinking about me." },
    { gender: "female", text: "Send a video playing with your belly button with only an underwear on." },
    { gender: "female", text: "Bite your lip and hold eye contact with the camera for 10 seconds." },
    { gender: "both", text: "Send a voice note saying my name in the sexiest way possible." },
    { gender: "both", text: "Describe in detail the last time you thought about me naked." },
    { gender: "both", text: "Make a 10-second video of you tracing your lips with your finger." },
    { gender: "female", text: "Describe how you want me to kiss you, step by step." },
    { gender: "female", text: "Send a flirty selfie with your hair tousled or messy." },
    { gender: "both", text: "Whisper a naughty secret about what you want to do to me." },
    { gender: "both", text: "Record yourself breathing heavily and send the clip." },
    { gender: "both", text: "Slowly say something we’ve never done but you want to try." },
    { gender: "male", text: "Act out your favorite intimate move on camera." },
    { gender: "female", text: "Describe what you’re wearing right now in a way that makes me blush." },
    { gender: "both", text: "Send a photo of your hand tracing your neck or collarbone." },
    { gender: "male", text: "Pretend you’re making out with me for 20 seconds on video." },
    { gender: "male", text: "Say a seductive sentence and repeat it with increasing intensity." },
    { gender: "male", text: "Send a 10-second video blowing a kiss to the camera." },
    { gender: "both", text: "Take a video slowly taking off your shirt but stop before it’s fully off." },
    { gender: "both", text: "Take a selfie wearing just your underwear or boxers." },
    { gender: "both", text: "Describe the first thing you’d do if you could touch me right now — make it explicit." },
    { gender: "both", text: "Send a picture of my favorite part on you." },
    { gender: "both", text: "Spell out what you want to do to your partner using only emojis." },
    { gender: "both", text: "Send a picture of something I'd be touching if you were here." },
    { gender: "both", text: "Tell me your favorite position to imagine us in — describe it in detail." },
    { gender: "male", text: "Make a video pretending to kiss me passionately and whisper something naughty after." },
    { gender: "male", text: "Describe exactly how you’d touch me, including where and how." },
    { gender: "both", text: "Whisper your dirtiest fantasy into the mic — no holding back." },
    { gender: "both", text: "Show me the last X-rated clip you watched." },
    { gender: "both", text: "Make a video slowly taking off your underwear, you can stop whenever you want." },
    { gender: "female", text: "Describe your favorite spot on your body that you want me to kiss — in detail." },
    { gender: "both", text: "Send a photo in your favorite underwear." },
    { gender: "both", text: "Fake an orgasm for 1 minute on video." },
    { gender: "male", text: "Send a slow video of you tracing your abs and chest with your fingertips, making it clear you’re thinking of me." },
    { gender: "both", text: "Do whatever I ask for 1 minute." },
    { gender: "female", text: "Tell me who in your contact list you would most want us to have a threesome with." },
    { gender: "both", text: "Snap a photo of a mystery part of your body and have me guess." },
    { gender: "both", text: "Make your silliest face, send a picture." }
  ];

  // 50 Spicy Truths
  const spicyTruths = [
    "What’s your most embarrassing sexual story?",
    "Who was your first crush and what did you do about it?",
    "Have you ever sent a sext? Show us the message if you still have it.",
    "What’s your wildest fantasy you haven’t told anyone?",
    "Describe your first time in detail.",
    "Have you ever been caught doing something naughty? What happened?",
    "What’s your biggest secret crush right now?",
    "What’s the sexiest dream you’ve ever had about me?",
    "Have you ever lied about your experience? Explain.",
    "What’s the kinkiest thing you’d try if no one judged you?",
    "Describe your ideal date night that leads to something more.",
    "Have you ever had a crush on a friend’s partner?",
    "What’s the most adventurous place you’ve had sex?",
    "Have you ever been caught spying on someone? Details.",
    "What’s the naughtiest thing you’ve done in public?",
    "Do you prefer giving or receiving in bed? Why?",
    "What’s the wildest outfit you’ve worn to impress someone?",
    "Have you ever used food in a sexy way?",
    "What’s your secret turn-on?",
    "What’s the worst pickup line that actually worked?",
    "What’s your favorite body part on yourself and why?",
    "Have you ever faked an orgasm? When and why?",
    "What’s a taboo you want to break?",
    "Have you ever been attracted to someone you shouldn’t be?",
    "What’s your favorite way to be kissed?",
    "Have you ever had a crush on a teacher or boss?",
    "What’s your secret guilty pleasure?",
    "Describe your first kiss experience.",
    "What’s your favorite position and why?",
    "Have you ever been jealous during a relationship? Why?",
    "What’s your biggest sexual fantasy?",
    "Have you ever regretted something you did in bed?",
    "What’s the most romantic thing you’ve ever done?",
    "What’s your biggest turn-off?",
    "Have you ever had a one-night stand? Tell us about it.",
    "What’s the longest you’ve gone without sex and why?",
    "Have you ever kissed someone of the same gender?",
    "What’s the most embarrassing thing that happened during sex?",
    "What’s your wildest dream about me?",
    "Have you ever been attracted to a fictional character?",
    "What’s your favorite way to seduce someone?",
    "Have you ever been caught masturbating?",
    "What’s the kinkiest thing you want to try with me?",
    "What’s your favorite romantic movie or book?",
    "Have you ever role-played in bed?",
    "What’s your biggest fantasy involving me?",
    "Have you ever sent a naughty selfie? Show us.",
    "What’s your secret spot that feels amazing when touched?"
  ];

  // 30 Fun Dares
  const funDares = [
    "Sing the chorus of your favorite song out loud.",
    "Do your best dance move for 30 seconds.",
    "Imitate an animal of your choice for 20 seconds.",
    "Tell a joke that makes everyone laugh.",
    "Do 10 jumping jacks right now.",
    "Balance on one foot for 30 seconds.",
    "Make a funny face and hold it for 15 seconds.",
    "Say the alphabet backwards as fast as you can.",
    "Do your best celebrity impression.",
    "Speak in a different accent for the next 2 minutes.",
    "Try to lick your elbow.",
    "Act like a robot for 30 seconds.",
    "Pretend to be a news reporter giving a breaking news story.",
    "Do a silly walk across the room.",
    "Make up a short poem about the group.",
    "Do your best runway model walk.",
    "Tell a secret about yourself.",
    "Do 5 push-ups.",
    "Make a funny sound and repeat it 3 times.",
    "Pretend to be a cat and meow.",
    "Say something nice to every player.",
    "Do a silly dance with no music.",
    "Make your best scared face.",
    "Try to juggle 3 objects (or pretend).",
    "Do your best superhero pose.",
    "Pretend to be a statue for 1 minute.",
    "Make a shadow puppet of an animal.",
    "Act like you’re stuck in quicksand.",
    "Say a tongue twister 3 times fast.",
    "Make up a handshake with the person next to you."
  ];

  // 15 Fun Truths
  const funTruths = [
    "What’s your favorite funny memory?",
    "If you could have any superpower, what would it be?",
    "What’s your most embarrassing moment?",
    "What’s the silliest thing you’ve done for a laugh?",
    "If you were an animal, what would you be and why?",
    "What’s your favorite joke?",
    "What’s your go-to dance move?",
    "Have you ever laughed so hard you cried? What happened?",
    "What’s your guilty pleasure TV show or movie?",
    "What’s the weirdest food you’ve ever eaten?",
    "If you could switch lives with anyone for a day, who would it be?",
    "What’s a weird habit you have?",
    "What’s your funniest childhood memory?",
    "If you could instantly master a skill, what would it be?",
    "What’s the craziest thing you’ve done on a dare?"
  ];
</script>

<script>
  // Utilities for game

  function pickRandom(array) {
    return array[Math.floor(Math.random() * array.length)];
  }

  function buildChallengeObj(player, type, text) {
    return { player, type, text, byClient: localClientId, timestamp: Date.now() };
  }

  function pushChallengeToDB(challengeObj) {
    if (!isSyncing || !gameId) return;
    rdb.ref(`games/${gameId}/currentChallenge`).set(challengeObj).catch(err => console.error(err));
  }

  function getChallenge(type) {
    if (players.length === 0) {
      return { player: null, text: "Add players first!" };
    }
    const player = pickRandom(players);
    if (mode === "spicy") {
      if (type === "truth") {
        const text = pickRandom(spicyTruths);
        const obj = buildChallengeObj(player, "truth", text);
        pushChallengeToDB(obj);
        return { player, text };
      } else {
        const filteredDares = spicyDares.filter(d => d.gender === "both" || d.gender === player.gender);
        if (filteredDares.length === 0) {
          return { player, text: "No dares available for this gender." };
        }
        const text = pickRandom(filteredDares).text;
        const obj = buildChallengeObj(player, "dare", text);
pushChallengeToDB(obj);
return { player, text };
} else { // fun mode
  const text = pickRandom(funDares);
  const obj = buildChallengeObj(player, "dare", text);
  pushChallengeToDB(obj);
  return { player, text };
}
}

// Display challenge in UI for client (called on DB update)
function showChallengeForClient(challengeObj) {
  if (!challengeObj || !challengeObj.player) {
    challengeDiv.innerHTML = `<p>${challengeObj && challengeObj.text ? challengeObj.text : "Add players first!"}</p>`;
    return;
  }
  const name = challengeObj.player.name || challengeObj.player;
  const capType = challengeObj.type ? challengeObj.type.charAt(0).toUpperCase() + challengeObj.type.slice(1) : "Challenge";
  challengeDiv.innerHTML = `<p><strong>${name}'s ${capType}:</strong> ${challengeObj.text}</p>`;
}

// Event listeners for Truth and Dare buttons
truthBtn.addEventListener("click", () => {
  const result = getChallenge("truth");
  if (!result.player) {
    challengeDiv.innerHTML = `<p>${result.text}</p>`;
  } else {
    challengeDiv.innerHTML = `<p><strong>${result.player.name}'s Truth:</strong> ${result.text}</p>`;
  }
});

dareBtn.addEventListener("click", () => {
  const result = getChallenge("dare");
  if (!result.player) {
    challengeDiv.innerHTML = `<p>${result.text}</p>`;
  } else {
    challengeDiv.innerHTML = `<p><strong>${result.player.name}'s Dare:</strong> ${result.text}</p>`;
  }
});

// Local scoreboard object to track points by player
const scoreboard = {};

// Render scoreboard UI below challenge
function renderScoreboard() {
  let sb = document.getElementById('scoreboard');
  if (!sb) {
    sb = document.createElement('div');
    sb.id = 'scoreboard';
    sb.style.maxWidth = '400px';
    sb.style.margin = '14px auto';
    sb.style.background = '#222';
    sb.style.borderRadius = '8px';
    sb.style.padding = '10px';
    sb.style.textAlign = 'left';
    challengeDiv.parentNode.insertBefore(sb, challengeDiv.nextSibling);
  }
  let html = '<strong>Scoreboard</strong><ul style="list-style:none;padding:6px 0;margin:0;">';
  if (players.length === 0) html += '<li>No players yet.</li>';
  players.forEach(p => {
    const pts = scoreboard[p.name] || 0;
    html += `<li>${p.name}: ${pts} point${pts === 1 ? '' : 's'}</li>`;
  });
  html += '</ul>';
  sb.innerHTML = html;
}

// Award a point to a player and sync scoreboard
function awardPoint(playerName) {
  scoreboard[playerName] = (scoreboard[playerName] || 0) + 1;
  renderScoreboard();
  pushScoresToDB(scoreboard);
}

// Fail challenge (no points awarded)
function failChallenge() {
  // Can extend to log fails if needed
}

// Create Completed / Failed buttons UI below challenge div
(function createCompletionButtons() {
  // Prevent duplicate creation
  if (document.getElementById('completionButtons')) return;

  const div = document.createElement('div');
  div.id = 'completionButtons';
  div.style.marginTop = '12px';
  div.innerHTML = `
    <input id="completePlayerInput" placeholder="Player who completed (name)" 
      style="padding:8px;border-radius:6px;border:none;margin-right:6px;" 
      aria-label="Player who completed challenge"/>
    <button id="completedBtn" style="background-color:#4CAF50;color:#fff;">Completed</button>
    <button id="failedBtn" style="background-color:#f44336;color:#fff;margin-left:6px;">Failed</button>
  `;

  challengeDiv.parentNode.insertBefore(div, challengeDiv.nextSibling);

// Award point button
  document.getElementById('completedBtn').addEventListener('click', () => {
    const pname = document.getElementById('completePlayerInput').value.trim();
    if (!pname) {
      alert('Enter player name who completed the challenge.');
      return;
    }
    awardPoint(pname);
    document.getElementById('completePlayerInput').value = '';
    // Clear current challenge in DB
    if (isSyncing && gameId) {
      rdb.ref(`games/${gameId}/currentChallenge`).set(null);
    }
    challengeDiv.innerHTML = "<p>Choose Truth or Dare and have fun!</p>";
  });

  // Fail challenge button
  document.getElementById('failedBtn').addEventListener('click', () => {
    document.getElementById('completePlayerInput').value = '';
    if (isSyncing && gameId) {
      rdb.ref(`games/${gameId}/currentChallenge`).set(null);
    }
    challengeDiv.innerHTML = "<p>Challenge failed — next turn!</p>";
  });
})();

// On page load, initialize the UI state:
updatePlayerList();
updateButtonsState();
renderScoreboard();

<script>
  const challengeDiv = document.getElementById('challenge');
  const truthBtn = document.getElementById('truthBtn');
  const dareBtn = document.getElementById('dareBtn');
  const startBtn = document.getElementById('startBtn');
  const joinBtn = document.getElementById('joinBtn');
  const scoreboardDiv = document.getElementById('scoreboard');
  const resetBtn = document.getElementById('resetBtn');

  // Current challenge stored locally to avoid repeats
  let currentChallenge = null;

  // Render scoreboard UI
  function renderScoreboard() {
    if (players.length === 0) {
      scoreboardDiv.innerHTML = '<p>No players added yet.</p>';
      return;
    }

    let html = '<table><tr><th>Player</th><th>Completed</th><th>Skipped</th></tr>';
    players.forEach(p => {
      const name = p.name;
      const stats = scoreboard[name] || { completed: 0, skipped: 0 };
      html += `<tr>
        <td>${name}</td>
        <td>${stats.completed || 0}</td>
        <td>${stats.skipped || 0}</td>
      </tr>`;
    });
    html += '</table>';
    scoreboardDiv.innerHTML = html;
  }

  // Display a challenge nicely in the UI
  function showChallengeForClient(challengeObj) {
    currentChallenge = challengeObj;
    if (!challengeObj || !challengeObj.player) {
      challengeDiv.innerHTML = `<p>${challengeObj && challengeObj.text ? challengeObj.text : "Add players first!"}</p>`;
      return;
    }
    const name = challengeObj.player.name || challengeObj.player;
    const type = challengeObj.type;
    const text = challengeObj.text;

    challengeDiv.innerHTML = `
      <p><strong>${name}</strong>, your <em>${type}</em> is:</p>
      <p style="font-size:1.25em; font-weight:bold; margin-top:0.5em;">${text}</p>
      <button id="completedBtn">Completed ✅</button>
      <button id="skippedBtn">Skipped ❌</button>
    `;

    // Setup button listeners to update scoreboard
    document.getElementById('completedBtn').onclick = () => {
      updateScore(currentChallenge.player.name, true);
      clearChallenge();
    };
    document.getElementById('skippedBtn').onclick = () => {
      updateScore(currentChallenge.player.name, false);
      clearChallenge();
    };
  }

  // Clear current challenge from UI and Firebase
  function clearChallenge() {
    currentChallenge = null;
    challengeDiv.innerHTML = '<p>Choose Truth or Dare and have fun!</p>';
    if (isSyncing && gameId) {
      rdb.ref(`games/${gameId}/currentChallenge`).remove().catch(console.error);
    }
  }

  // Update scoreboard for a player (completed = true if completed, false if skipped)
  function updateScore(playerName, completed) {
    if (!playerName) return;
    if (!scoreboard[playerName]) {
      scoreboard[playerName] = { completed: 0, skipped: 0 };
    }
    if (completed) {
      scoreboard[playerName].completed++;
    } else {
      scoreboard[playerName].skipped++;
    }
    renderScoreboard();
    pushScoresToDB(scoreboard);
  }

  // Event handlers for Truth and Dare buttons
  truthBtn.addEventListener('click', () => {
    const challenge = getChallenge('truth');
    showChallengeForClient(challenge);
  });

  dareBtn.addEventListener('click', () => {
    const challenge = getChallenge('dare');
    showChallengeForClient(challenge);
  });

  // Event handler for start/join buttons
  startBtn.addEventListener('click', () => {
    if (players.length === 0) {
      alert('Add at least one player before starting a game.');
      return;
    }
    const newGameId = prompt('Enter a room code to start (or create) a game:', 'room1');
    if (newGameId) {
      startSession(newGameId);
    }
  });

  joinBtn.addEventListener('click', () => {
    const joinGameId = prompt('Enter the room code to join a game:');
    if (joinGameId) {
      startSession(joinGameId);
    }
  });

  // Reset game: clears Firebase data and local state
  resetBtn.addEventListener('click', () => {
    if (!isSyncing || !gameId) {
      alert('No active game session to reset.');
      return;
    }
    if (!confirm('Are you sure you want to reset the current game? This will remove all players and scores.')) return;

    rdb.ref(`games/${gameId}`).remove()
      .then(() => {
        players.length = 0;
        scoreboard = {};
        updatePlayerList();
        renderScoreboard();
        resetChallenge();
        isSyncing = false;
        gameId = null;
        setRoomInfo('Game reset. You can start or join a new game.');
      })
      .catch(console.error);
  });

  // Set room info text on UI
  function setRoomInfo(text) {
    const roomInfo = document.getElementById('roomInfo');
    if (roomInfo) roomInfo.textContent = text;
  }

  // Initial UI setup
  updatePlayerList();
  updateButtonsState();
  renderScoreboard();
  resetChallenge();

</script>
