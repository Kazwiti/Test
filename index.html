<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Truth or Dare - Extremely Naughty Edition</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #eee;
    text-align: center;
    padding: 20px;
  }
  input, select, button {
    padding: 10px 15px;
    margin: 5px;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
  }
  button {
    cursor: pointer;
  }
  button:disabled {
    opacity: 0.5;
    cursor: default;
  }
  #player-list {
    margin: 10px 0;
    font-weight: bold;
  }
  #challenge {
    margin-top: 30px;
    padding: 20px;
    background: #222;
    border-radius: 12px;
    min-height: 100px;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }
  #challenge p {
    font-size: 1.2rem;
    user-select: text;
  }
  label {
    font-weight: bold;
  }
  #mode-select {
    margin-top: 15px;
  }

  /* small lobby area styling */
  #lobby {
    margin-bottom: 12px;
  }
  #roomInfo {
    margin-top: 8px;
    font-size: 0.95rem;
    color: #ddd;
  }
</style>
</head>
<body>

<h1>Truth or Dare - Extremely Naughty Edition</h1>

<!-- Multiplayer lobby controls (non-intrusive) -->
<div id="lobby">
  <input type="text" id="roomInput" placeholder="Enter or create room code" aria-label="Room code" />
  <button id="createRoomBtn">Create Room</button>
  <button id="joinRoomBtn">Join Room</button>
  <div id="roomInfo" aria-live="polite"></div>
</div>

<!-- Existing player input area (unchanged) -->
<div>
  <input type="text" id="player-name" placeholder="Enter player name" aria-label="Player name" />
  <label for="player-gender">Gender:</label>
  <select id="player-gender" aria-label="Player gender">
    <option value="male" selected>Male</option>
    <option value="female">Female</option>
  </select>
  <button id="addPlayerBtn">Add Player</button>
</div>

<div id="player-list" aria-live="polite" aria-atomic="true">Players: None</div>

<div id="mode-select">
  <label for="mode">Choose game mode:</label>
  <select id="mode" aria-label="Game mode">
    <option value="spicy" selected>Extremely Naughty</option>
    <option value="fun">Fun</option>
  </select>
</div>

<div>
  <button id="truthBtn" disabled>Truth</button>
  <button id="dareBtn" disabled>Dare</button>
</div>

<div id="challenge" role="region" aria-live="polite" aria-atomic="true">
  <p>Add players to start the game!</p>
</div>

<!-- Firebase Realtime Database (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // --- Firebase config: REPLACE placeholders with your real Firebase config ---
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "game-project.firebaseapp.com",
    databaseURL: "https://game-project-default-rtdb.firebaseio.com",
    projectId: "game-project",
    storageBucket: "game-project.appspot.com",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const rdb = firebase.database();

  // Multiplayer session variables
  let gameId = null; // the room code / session id
  let isSyncing = false; // true when connected to a game
  const localClientId = Math.random().toString(36).slice(2,10); // small id for this browser instance

  const roomInput = document.getElementById('roomInput');
  const createRoomBtn = document.getElementById('createRoomBtn');
  const joinRoomBtn = document.getElementById('joinRoomBtn');
  const roomInfo = document.getElementById('roomInfo');

  createRoomBtn.addEventListener('click', () => {
    // generate a simple 6-char room code
    const code = Math.random().toString(36).slice(2,8).toUpperCase();
    // set URL param and start session
    const newUrl = new URL(window.location.href);
    newUrl.searchParams.set('game', code);
    window.history.replaceState({}, '', newUrl);
    roomInput.value = code;
    startSession(code);
  });

  joinRoomBtn.addEventListener('click', () => {
    const code = roomInput.value.trim().toUpperCase();
    if (!code) {
      alert('Enter a room code to join or create one.');
      return;
    }
    // set URL param and start session
    const newUrl = new URL(window.location.href);
    newUrl.searchParams.set('game', code);
    window.history.replaceState({}, '', newUrl);
    startSession(code);
  });

  // Auto-join if ?game=CODE present
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.has('game')) {
    const code = urlParams.get('game').toUpperCase();
    roomInput.value = code;
    startSession(code);
  }

  // helper to set room info text
  function setRoomInfo(text) {
    roomInfo.textContent = text;
  }
</script>

<script>
  // Existing game state (local mirror). We will keep using these arrays/vars but they will be synced if in a session.
  const players = [];

  const playerNameInput = document.getElementById("player-name");
  const playerGenderSelect = document.getElementById("player-gender");
  const addPlayerBtn = document.getElementById("addPlayerBtn");
  const playerListDiv = document.getElementById("player-list");
  const truthBtn = document.getElementById("truthBtn");
  const dareBtn = document.getElementById("dareBtn");
  const challengeDiv = document.getElementById("challenge");
  const modeSelect = document.getElementById("mode");

  let mode = modeSelect.value;

  modeSelect.addEventListener("change", () => {
    mode = modeSelect.value;
    resetChallenge();
    // if in session, sync mode to db
    if (isSyncing && gameId) {
      rdb.ref(`games/${gameId}/mode`).set(mode).catch(err => console.error(err));
    }
  });

  // Override add-player action: if in a session, add to DB; otherwise local as before.
  addPlayerBtn.addEventListener("click", async () => {
    const name = playerNameInput.value.trim();
    const gender = playerGenderSelect.value;
    if (!name) {
      alert("Please enter a player name.");
      return;
    }

    // If syncing, write to DB; otherwise keep local behavior
    if (isSyncing && gameId) {
      const key = name.toLowerCase();
      try {
        // set a player object under games/{gameId}/players/{key}
        await rdb.ref(`games/${gameId}/players/${key}`).set({ name, gender });
        playerNameInput.value = "";
        playerNameInput.focus();
        challengeDiv.innerHTML = "<p>Choose Truth or Dare and have fun!</p>";
      } catch (err) {
        console.error('Failed to add player to DB:', err);
        alert('Failed to add player. Check console.');
      }
      return;
    }

    // local-only (no DB)
    if(players.some(p => p.name.toLowerCase() === name.toLowerCase())) {
      alert("This player name is already added.");
      return;
    }
    players.push({ name, gender });
    updatePlayerList();
    playerNameInput.value = "";
    playerNameInput.focus();
    updateButtonsState();
    challengeDiv.innerHTML = "<p>Choose Truth or Dare and have fun!</p>";
  });

  function updatePlayerList() {
    if (players.length === 0) {
      playerListDiv.textContent = "Players: None";
    } else {
      playerListDiv.textContent = "Players: " + players.map(p => p.name + " (" + p.gender + ")").join(", ");
    }
  }

  function updateButtonsState() {
    const hasPlayers = players.length > 0;
    truthBtn.disabled = !hasPlayers;
    dareBtn.disabled = !hasPlayers;
  }

  function resetChallenge() {
    challengeDiv.innerHTML = "<p>Add players to start the game!</p>";
    updateButtonsState();
  }

  // === Truth and Dare Data (unchanged content from your original file) ===

  const spicyTruths = [
    "What’s the dirtiest thing you’ve ever fantasized about us doing together?",
    "Have you ever had a secret sexual desire you’re too shy to say out loud?",
    "What’s the kinkiest place you’d want to have sex with me?",
    "What’s a sexual fantasy you’ve never told me but want to try?",
    "Have you ever fantasized about someone else while we were together?",
    "What’s the most adventurous thing you want to do in the bedroom?",
    "Describe your wildest orgasm experience with me.",
    "Have you ever been turned on by a naughty dream about me?",
    "What’s the one thing you want me to do that you’ve never asked for?",
    "What’s your secret fantasy involving roleplay or costumes?",
    "What’s the dirtiest thing you want me to do to you right now?",
    "Have you ever had a public sexual encounter or fantasy? Describe it.",
    "What’s the wildest place you want to have sex that we haven’t tried yet?",
    "Have you ever been caught masturbating or having sex? What happened?",
    "What’s the biggest taboo fantasy you secretly want to explore with me?",
    "Have you ever used toys or props? Which ones and how?",
    "What’s the sexiest dream you’ve had about me that you can remember?",
    "Have you ever wanted to try BDSM? What’s your favorite part of that idea?",
    "Describe your favorite way to be kissed that drives you wild.",
    "What’s the naughtiest thing you’ve done while on a date with me?",
    "Have you ever wanted to film our intimate moments? Why or why not?",
    "What’s the one outfit or lingerie you want me to wear for you?",
    "Have you ever fantasized about a threesome or group sex with me?",
    "Describe in detail the last time you wanted me but had to wait.",
    "What’s a secret sexual habit you have that I might not know about?",
    "Have you ever had a fantasy involving a stranger? What was it?",
    "What’s the sexiest thing you want me to whisper while we’re together?",
    "Have you ever thought about exhibitionism or being watched?",
    "What’s your wildest memory of oral sex with me or someone else?",
    "Describe a time you felt extremely turned on by something unexpected.",
    "Have you ever wanted to try role swapping or gender play?",
    "What’s the one place on your body that, if touched right, drives you crazy?",
    "Have you ever written or thought about a dirty story starring us?",
    "What’s your favorite type of dirty talk during sex?",
    "Have you ever wanted to try erotic massage or tantra with me?",
    "Describe a fantasy that involves food, scents, or sensory play.",
    "Have you ever been curious about kink fetishes? Which ones intrigue you?",
    "What’s the most intense orgasm you’ve ever had and what caused it?",
    "Have you ever wanted to try silent sex or using only gestures?",
    "Describe how you want me to undress you, step by step.",
    "What’s your most secret and daring fantasy that you’ve never shared before?",
    "Have you ever had a sexual dream about someone we both know?",
    "What’s the naughtiest thought you’ve had about me in the last 24 hours?",
    "Have you ever been turned on by something taboo or forbidden?",
    "What’s the longest you’ve gone without sex and how did it affect you?",
    "Describe your favorite way to be teased until you can’t stand it anymore.",
    "Have you ever wanted to try spanking or being spanked? Details?",
    "What’s a secret place you want me to touch you that I haven’t found yet?",
    "Have you ever been caught doing something naughty? What happened next?",
    "What’s your favorite kind of foreplay and why does it drive you wild?",
    "Have you ever wanted to try edging or orgasm control?",
    "What’s the kinkiest thing you’ve ever done in public?",
    "Describe your favorite way to give or receive oral sex.",
    "Have you ever wanted to try sex toys together? Which ones?",
    "What’s your favorite dirty talk phrase to hear or say?",
    "Have you ever thought about having sex in a place where we might get caught?",
    "What’s the most embarrassing thing that turned you on?",
    "Have you ever fantasized about a forbidden or taboo roleplay?",
    "Describe your wildest wet dream involving me.",
    "What’s your favorite way to be touched to make you shiver?",
    "Have you ever wanted to try sensory deprivation or blindfolds?",
    "What’s a naughty secret you’ve never told anyone before?"
  ];

  const spicyDares = [
    { text: "Send me a teasing photo — just enough to make me want more.", gender: "both" },
    { text: "Whisper your dirtiest fantasy about me into the mic for 15 seconds.", gender: "both" },
    { text: "Act out the first time we had sex.", gender: "both" },
    { text: "Moan softly into the mic like you’re thinking about me.", gender: "female" },
    { text: "Send a video playing with your belly button with only an underwear on.", gender: "female" },
    { text: "Bite your lip and hold eye contact with the camera for 10 seconds.", gender: "female" },
    { text: "Send a voice note saying my name in the sexiest way possible.", gender: "both" },
    { text: "Describe in detail the last time you thought about me naked.", gender: "both" },
    { text: "Make a 10-second video of you tracing your lips with your finger.", gender: "both" },
    { text: "Describe how you want me to kiss you, step by step.", gender: "female" },
    { text: "Send a flirty selfie with your hair tousled or messy.", gender: "female" },
    { text: "Whisper a naughty secret about what you want to do to me.", gender: "both" },
    { text: "Record yourself breathing heavily and send the clip.", gender: "both" },
    { text: "Slowly say something we’ve never done but you want to try.", gender: "both" },
    { text: "Act out your favorite intimate move on camera.", gender: "male" },
    { text: "Describe what you’re wearing right now in a way that makes me blush.", gender: "female" },
    { text: "Send a photo of your hand tracing your neck or collarbone.", gender: "both" },
    { text: "Pretend you’re making out with me for 20 seconds on video.", gender: "male" },
    { text: "Say a seductive sentence and repeat it with increasing intensity.", gender: "male" },
    { text: "Send a 10-second video blowing a kiss to the camera.", gender: "male" },
    { text: "Take a video slowly taking off your shirt but stop before it’s fully off.", gender: "both" },
    { text: "Take a selfie wearing just your underwear or boxers.", gender: "both" },
    { text: "Describe the first thing you’d do if you could touch me right now — make it explicit.", gender: "both" },
    { text: "Send a picture of my favorite part on you.", gender: "both" },
    { text: "Spell out what you want to do to your partner using only emojis.", gender: "both" },
    { text: "Send a picture of something I'd be touching if you were here.", gender: "both" },
    { text: "Tell me your favorite position to imagine us in — describe it in detail.", gender: "both" },
    { text: "Make a video pretending to kiss me passionately and whisper something naughty after.", gender: "male" },
    { text: "Describe exactly how you’d touch me, including where and how.", gender: "male" },
    { text: "Whisper your dirtiest fantasy into the mic — no holding back.", gender: "both" },
    { text: "Show me the last X-rated clip you watched.", gender: "both" },
    { text: "Make a video slowly taking off your underwear, you can stop whenever you want.", gender: "both" },
    { text: "Describe your favorite spot on your body that you want me to kiss — in detail.", gender: "female" },
    { text: "Send a photo in your favorite underwear.", gender: "both" },
    { text: "Fake an orgasm for 1 minute on video.", gender: "both" },
    { text: "Send a slow video of you tracing your abs and chest with your fingertips, making it clear you’re thinking of me.", gender: "male" },
    { text: "Do whatever I ask for 1 minute.", gender: "both" },
    { text: "Tell me who in your contact list you would most want us to have a threesome with.", gender: "female" },
    { text: "Snap a photo of a mystery part of your body and have me guess.", gender: "both" },
    { text: "Make your silliest face, send a picture.", gender: "both" }
  ];

  // Fun truths and dares for a lighter option
  const funTruths = [
    "What’s your favorite memory with me?",
    "If you could travel anywhere with me, where would it be?",
    "What’s your secret talent?",
    "What’s a funny thing you did as a kid?",
    "Who was your first crush?",
    "What’s your go-to dance move?",
    "What’s the weirdest food you’ve ever tried?",
    "If you could be an animal, what would you be and why?",
    "What’s the last thing you laughed at really hard?",
    "What’s one thing you’ve never told anyone?",
    "If you could have any superpower, what would it be?",
    "What’s your guilty pleasure TV show or movie?",
    "Have you ever had a crush on a teacher?",
    "What’s your favorite way to relax?",
    "If you could instantly master a skill, what would it be?",
    "What’s your weirdest fear?",
    "What’s the most embarrassing thing that ever happened to you?",
    "What’s your favorite joke?",
    "If you were stranded on an island, what 3 things would you bring?",
    "What’s something you’ve done that you’re proud of?",
    "What’s your dream job?",
    "What’s your favorite childhood cartoon?",
    "What’s a habit you wish you could break?",
    "What’s the best compliment you’ve ever received?",
    "What’s your favorite holiday and why?",
    "If you could meet any celebrity, who would it be?",
    "What’s your favorite song to dance to?",
    "What’s one thing you want to learn this year?",
    "What’s your favorite way to spend a weekend?",
    "What’s your go-to comfort food?"
  ];

  const funDares = [
    "Do your best celebrity impression.",
    "Sing the chorus of your favorite song.",
    "Do 10 jumping jacks right now.",
    "Talk in a funny accent for the next 2 rounds.",
    "Show your funniest dance move.",
    "Send a silly selfie right now.",
    "Make up a poem about the person to your left.",
    "Do your best animal sound impression.",
    "Spin around 5 times and try to walk straight.",
    "Pretend you’re a superhero for the next minute.",
    "Make a funny face and hold it for 10 seconds.",
    "Say the alphabet backwards as fast as you can.",
    "Act like your favorite cartoon character.",
    "Tell a joke and try to make everyone laugh.",
    "Do your best runway walk across the room.",
    "Make a hat out of something nearby and wear it.",
    "Try to lick your elbow.",
    "Make up a short story on the spot.",
    "Balance on one leg for 15 seconds.",
    "Show us your best silly dance.",
    "Say ‘I love [player name]’ in a dramatic voice.",
    "Pretend to be a news anchor for 1 minute.",
    "Try to whistle a song.",
    "Make a funny face and send it to the chat.",
    "Imitate a famous movie scene.",
    "Pretend to be a cat for 30 seconds.",
    "Do your best robot dance.",
    "Draw a quick doodle and show it to everyone.",
    "Say a tongue twister 3 times fast.",
    "Pretend you’re on a cooking show and describe a recipe."
  ];
</script>

<script>
  // Utility
  function pickRandom(array) {
    return array[Math.floor(Math.random() * array.length)];
  }

  // Compose the challenge object (player, type, text)
  function buildChallengeObj(player, type, text) {
    return { player, type, text, byClient: localClientId, timestamp: Date.now() };
  }

  // When a challenge is generated locally, if in session we push it to DB so others see it.
  function pushChallengeToDB(challengeObj) {
    if (!isSyncing || !gameId) return;
    rdb.ref(`games/${gameId}/currentChallenge`).set(challengeObj).catch(err => console.error(err));
  }

  // When scores update (local completion), sync to DB
  function pushScoresToDB(scoreboard) {
    if (!isSyncing || !gameId) return;
    rdb.ref(`games/${gameId}/scoreboard`).set(scoreboard).catch(err => console.error(err));
  }

  // Get challenge (returns object, but also if syncing will write to DB)
  function getChallenge(type) {
    if (players.length === 0) {
      return { player: null, text: "Add players first!" };
    }
    const player = pickRandom(players);
    if (mode === "spicy") {
      if (type === "truth") {
        const text = pickRandom(spicyTruths);
        const obj = buildChallengeObj(player, "truth", text);
        // sync
        pushChallengeToDB(obj);
        return { player, text };
      } else {
        const filteredDares = spicyDares.filter(
          (d) => d.gender === "both" || d.gender === player.gender
        );
        if (filteredDares.length === 0) {
          return { player, text: "No dares available for this gender." };
        }
        const text = pickRandom(filteredDares).text;
        const obj = buildChallengeObj(player, "dare", text);
        pushChallengeToDB(obj);
        return { player, text };
      }
    } else { // fun
      if (type === "truth") {
        const text = pickRandom(funTruths);
        const obj = buildChallengeObj(player, "truth", text);
        pushChallengeToDB(obj);
        return { player, text };
      } else {
        const text = pickRandom(funDares);
        const obj = buildChallengeObj(player, "dare", text);
        pushChallengeToDB(obj);
        return { player, text };
      }
    }
  }

  // Display helper (also used when DB pushes a new challenge)
  function showChallengeForClient(challengeObj) {
    if (!challengeObj || !challengeObj.player) {
      challengeDiv.innerHTML = `<p>${challengeObj && challengeObj.text ? challengeObj.text : "Add players first!"}</p>`;
      return;
    }
    const name = challengeObj.player.name || challengeObj.player;
    const capType = challengeObj.type ? challengeObj.type.charAt(0).toUpperCase() + challengeObj.type.slice(1) : "Challenge";
    challengeDiv.innerHTML = `<p><strong>${name}'s ${capType}:</strong> ${challengeObj.text}</p>`;
  }

  // Event handlers for buttons - these will generate challenge and push to DB inside getChallenge()
  truthBtn.addEventListener("click", () => {
    const result = getChallenge("truth");
    if (!result.player) {
      challengeDiv.innerHTML = `<p>${result.text}</p>`;
    } else {
      challengeDiv.innerHTML = `<p><strong>${result.player.name}'s Truth:</strong> ${result.text}</p>`;
    }
  });

  dareBtn.addEventListener("click", () => {
    const result = getChallenge("dare");
    if (!result.player) {
      challengeDiv.innerHTML = `<p>${result.text}</p>`;
    } else {
      challengeDiv.innerHTML = `<p><strong>${result.player.name}'s Dare:</strong> ${result.text}</p>`;
    }
  });

  // Scoreboard: keep local object and sync to DB when updated
  const scoreboard = {}; // { playerName: points }

  // UI helper to update scoreboard area (we'll create a small scoreboard display under challenge)
  function renderScoreboard() {
    let sb = document.getElementById('scoreboard');
    if (!sb) {
      sb = document.createElement('div');
      sb.id = 'scoreboard';
      sb.style.maxWidth = '400px';
      sb.style.margin = '14px auto';
      sb.style.background = '#222';
      sb.style.borderRadius = '8px';
      sb.style.padding = '10px';
      sb.style.textAlign = 'left';
      challengeDiv.parentNode.insertBefore(sb, challengeDiv.nextSibling);
    }
    let html = '<strong>Scoreboard</strong><ul style="list-style:none;padding:6px 0;margin:0;">';
    if (players.length === 0) html += '<li>No players yet.</li>';
    players.forEach(p => {
      const pts = scoreboard[p.name] || 0;
      html += `<li>${p.name}: ${pts} point${pts === 1 ? '' : 's'}</li>`;
    });
    html += '</ul>';
    sb.innerHTML = html;
  }

  // When a player completes a challenge, call this to award a point
  // (you can wire this to the manual Completed button you asked for earlier)
  function awardPoint(playerName) {
    scoreboard[playerName] = (scoreboard[playerName] || 0) + 1;
    renderScoreboard();
    pushScoresToDB(scoreboard);
  }

  // Provide failing (no points) function too
  function failChallenge() {
    // no score change, but we could push a history if desired
  }
</script>

<script>
  // Start session helper - attaches listeners and initializes game node if missing
  function startSession(code) {
    if (!code) return;
    gameId = code;
    isSyncing = true;
    setRoomInfo(`Connected to room: ${gameId} — syncing in real time`);
    // create games/{gameId} if not exists (no overwrite)
    const gameRef = rdb.ref(`games/${gameId}`);
    gameRef.once('value').then(snap => {
      if (!snap.exists()) {
        // initialize structure
        gameRef.set({
          createdAt: Date.now(),
          mode: mode,
          currentChallenge: null,
          scoreboard: {},
          players: {}
        }).catch(err => console.error(err));
      }
    }).catch(err => console.error(err));

    // Listen players
    rdb.ref(`games/${gameId}/players`).on('value', snap => {
      // update local players array (mirror)
      players.length = 0; // clear
      const playersObj = snap.val() || {};
      Object.keys(playersObj).forEach(k => {
        const p = playersObj[k];
        players.push({ name: p.name, gender: p.gender });
        // ensure scoreboard entry exists locally
      });
      updatePlayerList();
      updateButtonsState();
      renderScoreboard();
    });

    // Listen mode
    rdb.ref(`games/${gameId}/mode`).on('value', snap => {
      const m = snap.val();
      if (m) {
        mode = m;
        modeSelect.value = m;
      }
    });

    // Listen currentChallenge
    rdb.ref(`games/${gameId}/currentChallenge`).on('value', snap => {
      const cc = snap.val();
      if (!cc) {
        // nothing
        return;
      }
      // update UI with the challenge from DB
      showChallengeForClient(cc);
    });

    // Listen scoreboard
    rdb.ref(`games/${gameId}/scoreboard`).on('value', snap => {
      const sb = snap.val() || {};
      // copy into local scoreboard
      Object.keys(sb).forEach(k => scoreboard[k] = sb[k]);
      renderScoreboard();
    });

    // Clean-up on disconnect of this client: optionally remove this client-specific data
    // We don't delete players automatically, because players are real entries; user must remove manually.
  }

  // Optional: function to remove a player (local UI can call this). If connected, remove from DB.
  function removePlayer(name) {
    const key = name.toLowerCase();
    if (isSyncing && gameId) {
      rdb.ref(`games/${gameId}/players/${key}`).remove().catch(err => console.error(err));
    } else {
      const idx = players.findIndex(p => p.name.toLowerCase() === name.toLowerCase());
      if (idx >= 0) {
        players.splice(idx,1);
        updatePlayerList();
        updateButtonsState();
      }
    }
  }

  // Provide simple Completed/Failed buttons under challenge to manually award points (UI creation)
  (function createCompletionButtons() {
    const existing = document.getElementById('completionButtons');
    if (existing) return;
    const div = document.createElement('div');
    div.id = 'completionButtons';
    div.style.marginTop = '12px';
    div.innerHTML = `
      <input id="completePlayerInput" placeholder="Player who completed (name)" style="padding:8px;border-radius:6px;border:none;margin-right:6px;" />
      <button id="completedBtn" style="background-color:#4CAF50;color:#fff;">Completed</button>
      <button id="failedBtn" style="background-color:#f44336;color:#fff;margin-left:6px;">Failed</button>
    `;
    challengeDiv.parentNode.insertBefore(div, challengeDiv.nextSibling);

    document.getElementById('completedBtn').addEventListener('click', () => {
      const pname = document.getElementById('completePlayerInput').value.trim();
      if (!pname) return alert('Enter player name who completed the challenge.');
      awardPoint(pname);
      document.getElementById('completePlayerInput').value = '';
      // Optionally clear current challenge in DB
      if (isSyncing && gameId) rdb.ref(`games/${gameId}/currentChallenge`).set(null);
      challengeDiv.innerHTML = "<p>Choose Truth or Dare and have fun!</p>";
    });

    document.getElementById('failedBtn').addEventListener('click', () => {
      const pname = document.getElementById('completePlayerInput').value.trim();
      document.getElementById('completePlayerInput').value = '';
      if (isSyncing && gameId) rdb.ref(`games/${gameId}/currentChallenge`).set(null);
      challengeDiv.innerHTML = "<p>Challenge failed — next turn!</p>";
    });
  })();

  // Ensure local UI initial state
  updatePlayerList();
  updateButtonsState();
  renderScoreboard();
</script>
</body>
</html>
